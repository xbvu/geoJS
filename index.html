
<!DOCTYPE html>
<html>
<body>

<h1>IP and Geolocation information</h1>

<p id="deviceLocation"></p>
<p id="ipField"></p>
<p id="ipLocation"></p>
<p id="distanceFromIP"></p>  
  
  
<script>
var ipApiURL = 'https://ipapi.co/json';

var deviceLocation = document.getElementById("deviceLocation");
var ipField = document.getElementById("ipField");
var ipLocation = document.getElementById("ipLocation");
var distanceFromIP = document.getElementById("distanceFromIP");

// as explained in https://www.movable-type.co.uk/scripts/latlong.html
function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
    var R = 6371; // earth radius in kilometers
    var dLat = deg2rad(lat2 - lat1); // latitude delta
    var dLon = deg2rad(lon2 - lon1); // longtitude delta
    var a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    var d = R * c;
    return d;
}

function deg2rad(deg) {
    return deg * (Math.PI / 180)
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var response = JSON.parse(this.responseText);
        if (response.status !== 'success') {
            console.log('query failed: ' + response.message);
            return
        }

        ipField.innerHTML = "<b>IP Address:</b><br><i>&nbsp;" + response.ip + "</i>[<font color='green'>OK</font>]";
		ipLocation.innerHTML = "<b>IP Location:</b><br>&nbsp;Latitude: <i>" + response.latitude +
                "</i><br>&nbsp;Longitude: <i>" + response.longtitude + "</i>";

        if (navigator.geolocation) {
            deviceLocation.innerHTML = "<b>Device Location:</b><br>&nbsp;Latitude: <i>[<font color='green'>OK</font>]" + position.coords.latitude +
                "</i><br>&nbsp;Longitude: <i>" + position.coords.longitude + "</i>[<font color='green'>OK</font>]";
            var diff = getDistanceFromLatLonInKm(coords[i].lat, coords[i].lon, response.latitude, response.longtitude);
            distanceFromIP.innerHTML = "<b>Distance from Geo to IP location : <br><i>&nbsp;" + Number((diff).toFixed(2)) + "</i> KM [<font color='green'>OK</font>]";
        } else {
            deviceLocation.innerHTML = "<b>Device Location:</b><br>&nbsp;Latitude: <i>none</i>[<font color='red'>unavailable</font>]<br>&nbsp;Longitude: <i>none</i>[<font color='red'>unavailable</font>]";
            distanceFromIP.innerHTML = "<b>Distance from Geo to IP location : <br><i>&nbsp; none</i>[<font color='red'>unavailable</font>]";
        }


    }
};
xhr.open('GET', ipApiURL, true);
xhr.send();
</script>

</body>
</html>
