
<!DOCTYPE html>
<html>
<body>

<h1>IP and Geolocation information</h1>

<p id="deviceLocation"></p>
<p id="ipField"></p>
<p id="ipLocation"></p>
<p id="distanceFromIP"></p>  
  
  
<script>
var ipApiURL = 'https://ipapi.co/json';

var deviceLocation = document.getElementById("deviceLocation");
var ipField = document.getElementById("ipField");
var ipLocation = document.getElementById("ipLocation");
var distanceFromIP = document.getElementById("distanceFromIP");

// as explained in https://www.movable-type.co.uk/scripts/latlong.html
function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
    var R = 6371; // earth radius in kilometers
    var dLat = deg2rad(lat2 - lat1); // latitude delta
    var dLon = deg2rad(lon2 - lon1); // longtitude delta
    var a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    var d = R * c;
    return d;
}

function deg2rad(deg) {
    return deg * (Math.PI / 180)
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var response = JSON.parse(this.responseText);
        ipField.innerHTML = "<b>IP Address:</b><br><i>&nbsp;" + response.ip + "</i>&nbsp;[<font color='green'>OK</font>]";
		ipLocation.innerHTML = "<b>IP Location:</b><br>&nbsp;Latitude: <i>" + response.latitude +
                "</i>&nbsp;[<font color='green'>OK</font>]<br>&nbsp;Longitude: <i>" + response.longitude + "</i>&nbsp;[<font color='green'>OK</font>]";

        if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            deviceLocation.innerHTML = "<b>Device Location:</b><br>&nbsp;Latitude: <i>none</i>&nbsp;[<font color='red'>unavailable</font>]<br>&nbsp;Longitude: <i>none</i>&nbsp;[<font color='red'>unavailable</font>]";
            distanceFromIP.innerHTML = "<b>Distance from Geo to IP location : <br><i>&nbsp; none</i>&nbsp;[<font color='red'>unavailable</font>]";
        }

		    function showPosition(position) {
				deviceLocation.innerHTML = "<b>Device Location:</b><br>&nbsp;Latitude: <i>" + Number((position.coords.latitude).toFixed(4)) +
					"</i>&nbsp;[<font color='green'>OK</font>]<br>&nbsp;Longitude: <i>" + Number((position.coords.longitude).toFixed(4)) + "</i>&nbsp;[<font color='green'>OK</font>]";
				var diff = getDistanceFromLatLonInKm(position.coords.latitude, position.coords.longitude, response.latitude, response.longitude);
				distanceFromIP.innerHTML = "<b>Distance from Geo to IP location: </b><br><i>&nbsp;" + Number((diff).toFixed(2)) + "</i> KM &nbsp;[<font color='green'>OK</font>]";
        }
    }
};
xhr.open('GET', ipApiURL, true);
xhr.send();
</script>

</body>
</html>
