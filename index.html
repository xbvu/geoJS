
<!DOCTYPE html>
<html>
<body>

<h1>IP and Geolocation information</h1>

<p id="deviceLocation"></p>
<p id="ipField"></p>
<p id="ipLocation"></p>
<p id="distanceFromIP"></p>  
  
  
<script>
var ipApiURL = 'https://ipapi.co/json';

var deviceLocation = document.getElementById("deviceLocation");
var ipField = document.getElementById("ipField");
var ipLocation = document.getElementById("ipLocation");
var distanceFromIP = document.getElementById("distanceFromIP");

// as explained in https://www.movable-type.co.uk/scripts/latlong.html
function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
    var R = 6371; // earth radius in kilometers
    var dLat = deg2rad(lat2 - lat1); // latitude delta
    var dLon = deg2rad(lon2 - lon1); // longtitude delta
    var a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    var d = R * c;
    return d;
}

function deg2rad(deg) {
    return deg * (Math.PI / 180)
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var response = JSON.parse(this.responseText);
        ipField.innerHTML = "<b>IP:</b> </i>" + response.ip + "</i>";
        ipLocation.innerHTML = "<b>IP Location:</b><br>  Latitude: <i>" + response.latitude +
            "</i><br>  Longitude: <i>" + response.longitude + "</i>";

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            deviceLocation.innerHTML = "Geolocation is unavailable";
        }


        function showPosition(position) {
            deviceLocation.innerHTML = "<b>Device Location:</b><br>  Latitude: <i>" + position.coords.latitude +
                "</i><br>  Longitude: <i>" + position.coords.longitude + "</i>";
            var diff = getDistanceFromLatLonInKm(coords[i].lat, coords[i].lon, response.latitude, response.longitude);
            distanceFromIP.innerHTML = "distance to IP location : " + diff + "km";
        }

    }
};
xhr.open('GET', ipApiURL, true);
xhr.send();
</script>

</body>
</html>
